// trace_ptr.bt
// è¿½è¹¤ service.inputPtr(cc *CC) string â€” hello_word.go:29
// CC struct { index int; name string }
// æ³¨æ„ï¼šGo DWARF type name å«æœ‰ "/" (bprf_demo/service.CC)ï¼Œbpftrace ç„¡æ³•è§£æï¼Œ
//       æ‰€ä»¥å¿…é ˆæ‰‹å‹•å®šç¾© struct
// éœ€è¦å®‰è£ : sudo apt install linux-headers-amd64

struct CC {
    long index;
    unsigned long name_data;
    long name_len;
};

uprobe:../myserver:bprf_demo/service.inputPtr
{
    $u = (struct CC *)arg0;
    printf("ğŸ‘‰ [inputPtr] è¢«å‘¼å«äº†ï¼ cc=%p, cc.index=%d, cc.name=\"%s\" (len=%d)\n",
        arg0, $u->index, str($u->name_data, $u->name_len), $u->name_len);
}

uretprobe:../myserver:bprf_demo/service.inputPtr
{
    // string å›å‚³: ax=data pointer, bx=length
    printf("ğŸ¯ [inputPtr] å›å‚³äº†ï¼ return_str=\"%s\"\n", str(retval, reg("bx")));
}

BEGIN
{
    printf("ğŸš€ é–‹å§‹è¿½è¹¤ service.inputPtr... æŒ‰ Ctrl+C çµæŸã€‚\n");
}
