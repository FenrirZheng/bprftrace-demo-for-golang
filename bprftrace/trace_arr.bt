// trace_arr.bt
// è¿½è¹¤ service.showArr(arr []string) â€” hello_word.go:65
// Go slice å…§éƒ¨çµæ§‹: {Data uintptr, Len int, Cap int}
// Go 1.17+ Register ABIï¼ˆå‚³å€¼ï¼Œæ‰“æ•£åˆ°æš«å­˜å™¨ï¼‰:
//   ax = Data (æŒ‡å‘åº•å±¤ string array çš„æŒ‡æ¨™)
//   bx = Len
//   cx = Cap
// æ¯å€‹ element æ˜¯ Go string = {Data uintptr, Len int} = 16 bytes
//   arr[0] = Data + 0*16,  arr[1] = Data + 1*16, ...
// éœ€è¦å®‰è£ : sudo apt install linux-headers-amd64

uprobe:../myserver:bprf_demo/service.showArr
{
    $data = reg("ax");
    $len  = reg("bx");
    $cap  = reg("cx");
    printf("ğŸ‘‰ [showArr] è¢«å‘¼å«äº†ï¼ len=%d, cap=%d\n", $len, $cap);

    // è®€å– arr[0]
    if ($len >= 1) {
        $s0_ptr = *(uint64 *)($data);
        $s0_len = *(int64 *)($data + 8);
        printf("   arr[0] = \"%s\" (len=%d)\n", str($s0_ptr, $s0_len), $s0_len);
    }

    // è®€å– arr[1]
    if ($len >= 2) {
        $s1_ptr = *(uint64 *)($data + 16);
        $s1_len = *(int64 *)($data + 24);
        printf("   arr[1] = \"%s\" (len=%d)\n", str($s1_ptr, $s1_len), $s1_len);
    }
}

BEGIN
{
    printf("ğŸš€ é–‹å§‹è¿½è¹¤ service.showArr... æŒ‰ Ctrl+C çµæŸã€‚\n");
}
