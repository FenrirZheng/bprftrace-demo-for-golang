// trace_fixed.bt

uprobe:../myserver:"bprf_demo/service.inputStruct"
{
    // Go 1.17+ Register ABI (Parameter Passing):
    // arg0 (AX) = cc.index (int)
    // arg1 (BX) = cc.name (pointer to string data)
    // arg2 (CX) = cc.name (length of string)

    // æ³¨æ„ï¼šé€™è£¡ä¸éœ€è¦ cast æˆ structï¼Œå› ç‚ºçµæ§‹å·²ç¶“è¢«æ‰“æ•£åœ¨æš«å­˜å™¨è£¡äº†

    // str(pointer, length) æ˜¯è®€å– Go String çš„æœ€ä½³æ–¹å¼
    printf("ğŸ‘‰ [inputStruct] è¢«å‘¼å«äº†ï¼ index=%d, name=\"%s\"\n",
           reg("ax"),
           str(reg("bx"), reg("cx")));
}

uretprobe:../myserver:"bprf_demo/service.inputStruct"
{
    // å›å‚³å€¼é€šå¸¸åœ¨ ax, bx ...
    // string å›å‚³ä¹Ÿæ˜¯ ptr(ax), len(bx)
    printf("ğŸ¯ [inputStruct] å›å‚³äº†ï¼ return_str=\"%s\"\n", str(retval, reg("dx")));
    // è¨»ï¼šå›å‚³å€¼çš„æš«å­˜å™¨ä½ç½®å¯èƒ½å›  Go ç‰ˆæœ¬ç•¥æœ‰ä¸åŒï¼Œé€šå¸¸æ˜¯ ax(data), bx(len) æˆ– ax(data), dx(len)
}

BEGIN
{
    printf("ğŸš€ é–‹å§‹è¿½è¹¤ service.inputStruct... æŒ‰ Ctrl+C çµæŸã€‚\n");
}